(function(){"use strict";var e={3955:function(e,t,a){var s=a(8935),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("div",{attrs:{id:"app_content"}},[a("router-view")],1)])},r=[],n={methods:{rejectPhone(){var e=navigator.userAgent,t=e.match(/(iPad).*OS\s([\d_]+)/),a=!t&&e.match(/(iPhone\sOS)\s([\d_]+)/),s=e.match(/(Android)\s+([\d.]+)/);(a||s)&&this.$router.replace({name:"error",params:{errorMsg:"使用iPad或者电脑来访问"}})}},beforeCreate(){this.$axios.interceptors.request.use((e=>(null!=localStorage.token&&""!==localStorage.token&&(e.headers.common["Login-Token"]=localStorage.token),e)),(e=>Promise.reject(e))),this.$axios.interceptors.response.use((e=>(412===e.data.code?(this.$store.state.token="",localStorage.removeItem("token"),localStorage.removeItem("username"),this.$router.replace({name:"login",params:{notice:!0}})):500===e.data.code&&this.$message.error(this.$store.state.serverErrMsg),e)),(e=>Promise.reject(e.response)))},mounted(){this.rejectPhone()}},o=n,l=a(1001),h=(0,l.Z)(o,i,r,!1,null,null,null),c=h.exports,d=a(2809),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("div",[a("h1",[e._v("玩点游戏吧")]),a("p",{attrs:{id:"home_content_comment1"}},[e._v("虽然界面有一点丑，所以wjn真帅")]),a("ul",{attrs:{id:"game_menu"}},e._l(e.games,(function(t,s){return a("router-link",{key:s,attrs:{to:t.to,tag:"span"}},[a("el-popover",{attrs:{content:t.description,placement:"right",title:"游戏说明",trigger:"hover",width:"200"}},[a("el-button",{staticStyle:{"margin-top":"10px",width:"250px","font-size":"20px"},attrs:{slot:"reference",type:"success"},slot:"reference"},[e._v(e._s(t.name)+" ")])],1),a("br")],1)})),1),e.isLogined?a("el-row",[a("span",{staticStyle:{"font-size":"15px","margin-right":"10px"}},[e._v("你好，"+e._s(e.username))]),a("el-button",{staticStyle:{"font-size":"15px"},attrs:{type:"text"},on:{click:e.logout}},[e._v("退出登录 ")])],1):a("el-row",[a("span",{staticStyle:{"font-size":"15px","margin-right":"10px"}},[e._v("你还没有登录")]),a("el-button",{staticStyle:{"font-size":"15px"},attrs:{type:"text"},on:{click:e.toLogin}},[e._v("点我去登录 ")])],1)],1)])},g=[],p={data(){return{games:[{name:"猜单双",to:"/game/odd_even",description:"2人游戏。一个人来猜对手出的弹珠为单还是双，并决定这一回合的赌注，赢了的一方会得到另一方猜测者押注的弹珠数量，每一个回合两人的身份会切换。如果回合结束后其中一个人的弹珠为负数，则游戏结束。这是来自鱿鱼游戏的猜弹珠游戏。"},{name:"五子棋",to:"/game/gobang",description:"2人游戏。这还用解释？"},{name:"记忆翻牌（计划中...）",to:"",description:"2人游戏。"},{name:"辽阳麻将（无限期推迟）",to:"",description:"4人游戏。"},{name:"聊天室",to:"/game/chat_room",description:"这不是个游戏，但是是游戏使用技术的实验程序。"}],isLogined:!1}},computed:{username(){return localStorage.username}},methods:{logout(){localStorage.removeItem("token"),localStorage.removeItem("username"),this.isLogined=!1},toLogin(){this.$router.push("/login")}},mounted(){this.$route.params.notice&&this.$message({type:"success",message:"登录成功！"}),this.isLogined=!(""===localStorage.token||null==localStorage.token)}},u=p,v=(0,l.Z)(u,m,g,!1,null,"317e43c4",null),f=v.exports,_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-container",[a("el-main",[a("div",{attrs:{id:"login"}},[a("h1",{},[e._v("小pè游戏")]),a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doLogin.apply(null,arguments)}}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{"show-password":""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),a("el-form-item",{staticStyle:{"text-align":"center"}},[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.logining,expression:"logining"}],attrs:{disabled:e.logining,type:"primary"},on:{click:e.doLogin}},[e._v("登录 ")]),a("el-button",{staticStyle:{float:"right"},attrs:{type:"text"},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v("注册账号 ")])],1)],1)],1)])],1),a("el-dialog",{attrs:{visible:e.dialogFormVisible,title:"注册账号",width:"500px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form1",staticStyle:{"margin-left":"20%","margin-right":"20%"},attrs:{model:e.form1,rules:e.rules}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{model:{value:e.form1.username,callback:function(t){e.$set(e.form1,"username",t)},expression:"form1.username"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{"show-password":""},model:{value:e.form1.password,callback:function(t){e.$set(e.form1,"password",t)},expression:"form1.password"}})],1),a("el-form-item",{attrs:{label:"验证码",prop:"password"}},[a("div",{staticStyle:{width:"100%",display:"flex","align-items":"center"}},[a("el-input",{staticStyle:{width:"calc(100% - 120px)","margin-right":"20px"},attrs:{"show-password":""},model:{value:e.form1.code,callback:function(t){e.$set(e.form1,"code",t)},expression:"form1.code"}}),a("el-image",{staticStyle:{width:"100px",height:"40px",cursor:"pointer"},attrs:{src:e.codeUrl},on:{click:e.updateCode}})],1)]),a("el-form-item",{staticStyle:{"text-align":"center"}},[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.registering,expression:"registering"}],attrs:{disabled:e.registering,type:"primary"},on:{click:e.doRegister}},[e._v("注册 ")])],1)],1)],1)],1)},b=[],y=a(7459),w=a.n(y),k={data:function(){return{form:{username:"",password:""},form1:{username:"",password:"",code:""},codeUrl:this.$store.state.backURL+"/kaptcha?d="+new Date,dialogFormVisible:!1,logining:!1,registering:!1,rules:{username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"},{min:6,message:"密码最少6位",trigger:"blur"}]}}},beforeCreate(){localStorage.token&&this.$router.push("/home")},mounted(){this.$route.params.notice&&this.$message({type:"info",message:"现在还没登录，先登录吧。"})},computed:{hashedPwd(){return w()(this.form.password)},hashedPwd1(){return w()(this.form1.password)}},methods:{doLogin(){this.$refs["form"].validate((e=>{if(e){if(this.logining=!0,localStorage.token)return void this.$router.push({name:"Home"});this.$axios({type:"get",url:this.$store.state.backURL+"/login/do_login",params:{username:this.form.username,password:this.hashedPwd}}).then((e=>{console.log(e),200===e.data.code?(localStorage.setItem("token",e.data.token),localStorage.setItem("username",e.data.username),this.$router.push("/home")):410===e.data.code?this.$message.error("用户不存在。"):this.$message.error("密码错误。"),this.logining=!1})).catch((e=>{this.$message.error(this.$store.state.serverErrMsg),console.log(e.msg),this.logining=!1}))}}))},doRegister(){this.registering=!0,this.$refs["form1"].validate((e=>{e?this.$axios.post(this.$store.state.backURL+"/register/do_register",{username:this.form1.username,password:this.hashedPwd1,code:this.form1.code}).then((e=>{200===e.data.code?(this.$message({type:"success",message:"注册成功"}),this.dialogFormVisible=!1):413===e.data.code?this.$message.error("参数不正确，注册失败。"):414===e.data.code?this.$message.error("用户名已存在。"):this.$message.error(this.$store.state.serverErrMsg),this.registering=!1})).catch((e=>{console.log(e),this.$message.error(this.$store.state.serverErrMsg),this.registering=!1})):this.registering=!1}))},updateCode(){this.codeUrl=this.$store.state.backURL+"/kaptcha?d="+new Date}}},$=k,x=(0,l.Z)($,_,b,!1,null,"aa8f50d4",null),D=x.exports,S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"game"},[a("div",{attrs:{id:"game_header"}},[a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{plain:"",type:"success"},on:{click:e.returnHome}},[a("i",{staticClass:"el-icon-back"}),e._v(" 返回 ")]),a("span",{staticStyle:{"margin-left":"20px","font-size":"20px"}},[e._v(e._s(this.$store.state.currentGameTitle))])],1),a("router-view",{attrs:{id:"router_view"}})],1)},C=[],O={methods:{returnHome(){this.$router.push("/")}}},W=O,E=(0,l.Z)(W,S,C,!1,null,"0fed0191",null),j=E.exports,F=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"odd_even",style:e.oddEvenStyle},[a("PregameComponent",{ref:"pregame"}),e.gameData.roleFlag>-1?a("div",{attrs:{id:"game_body"}},[a("h1",[e._v("对手："),a("span",{staticStyle:{color:"#409EFF"}},[e._v(e._s(e.gameData.opponent))])]),1===e.state?a("div",[0===e.gameData.roleFlag?a("div",[a("h1",[e._v("第"+e._s(e.gameData.round)+"回合你来出题")]),a("p",[e._v("准备好被对手猜的弹珠。")])]):e._e(),1===e.gameData.roleFlag?a("div",[a("h1",[e._v("第"+e._s(e.gameData.round)+"回合你来猜")]),a("p",[e._v("准备好押注的弹珠。")])]):e._e(),a("div",[a("el-row",{staticStyle:{width:"600px"}},[a("el-col",{attrs:{span:12}},[a("h3",[e._v("剩余的弹珠")]),a("div",[a("transition-group",{staticClass:"ball_container",attrs:{appear:"","enter-active-class":"animate__animated animate__bounceInDown","leave-active-class":"animate__animated animate__backOutUp"}},e._l(e.unusedChips,(function(t){return a("el-button",{key:t,staticStyle:{width:"45px",height:"45px",margin:"10px"},attrs:{circle:"",icon:"el-icon-plus",type:"primary"},on:{click:function(a){return e.useOneChip(t)}}})})),1)],1)]),a("el-col",{attrs:{span:12}},[0===e.gameData.roleFlag?a("h3",[e._v("用于出题的弹珠")]):a("h3",[e._v("用于押注的弹珠")]),a("div",[a("transition-group",{staticClass:"ball_container",attrs:{appear:"","enter-active-class":"animate__animated animate__bounceInDown","leave-active-class":"animate__animated animate__backOutUp"}},e._l(e.usedChips,(function(t){return a("el-button",{key:t,staticStyle:{width:"45px",height:"45px",margin:"10px"},attrs:{circle:"",icon:"el-icon-check",type:"success"},on:{click:function(a){return e.resetOneChip(t)}}})})),1)],1)])],1),1===e.gameData.roleFlag?a("el-row",[a("h3",[e._v("我猜对手是：")]),a("el-button",{attrs:{circle:"",type:"primary"},on:{click:e.changeOddOrEven}},[e._v(e._s(e.oddOrEvenStr))])],1):e._e(),a("el-button",{staticStyle:{"margin-top":"20px"},attrs:{disabled:e.isBtnDisabled,type:"success"},on:{click:e.sendData}},[e._v("我想好了 ")])],1)]):2===e.state?a("div",[a("h1",[e._v("请等待对手操作。")])]):3===e.state?a("div",[a("h1",[0===e.gameData.roleFlag&&e.gameData.deltaChip<0?a("span",{},[a("span",{staticStyle:{color:"#F56C6C"}},[e._v("你猜错了！")])]):0===e.gameData.roleFlag&&e.gameData.deltaChip>0?a("span",{},[a("span",{staticStyle:{color:"#67C23A"}},[e._v("你猜对了！")])]):1===e.gameData.roleFlag&&e.gameData.deltaChip>0?a("span",{},[a("span",{staticStyle:{color:"#67C23A"}},[e._v("对手猜错了")])]):a("span",[a("span",{staticStyle:{color:"#F56C6C"}},[e._v("对手猜对了！")])])]),1===e.gameData.roleFlag?a("p",[e._v(" 你出了"+e._s(e.gameData.prevUsed)+"，对手猜了"+e._s(e.getOpponentGuess())+"，押注了"+e._s(e.gameData.prevOpponentUsedChip)+" ")]):a("p",[e._v(" 对手出了"+e._s(e.gameData.prevOpponentUsedChip)+"，你猜了"+e._s(e.gameData.oddOrEvenStr)+"，押注了"+e._s(Math.ceil(e.gameData.deltaChip))+" ")]),a("h2",{},[e._v("弹珠"),e.gameData.deltaChip>0?a("span",[e._v("+")]):e._e(),a("span",[e._v(e._s(e.gameData.deltaChip))])]),a("el-button",{attrs:{type:"success"},on:{click:e.nextRound}},[e._v("继续")])],1):4===e.state?a("div",[a("h1",[e._v("游戏结束")]),a("h1",[e.gameData.chip<=0?a("span",{staticStyle:{color:"#F56C6C"}},[e._v("你输了")]):e._e(),e.gameData.chip>0?a("span",{staticStyle:{color:"#67C23A"}},[e._v("你赢了")]):e._e()])]):e._e()]):e._e()],1)},U=[],L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.state<6&&-1!==e.state?a("div",{attrs:{id:"pregame_container"}},[1===e.state?a("div",[a("h1",[e._v("你想？")]),a("el-button",{attrs:{type:"success"},on:{click:function(t){return e.changeState(2)}}},[e._v("创建房间")]),a("el-button",{attrs:{type:"success"},on:{click:function(t){return e.changeState(4)}}},[e._v("加入房间")])],1):2===e.state?a("div",[a("h1",[e._v("起个房间名")]),a("el-row",{attrs:{align:"center",type:"flex"}},[a("el-input",{staticClass:"input",attrs:{maxlength:"20",type:"text"},model:{value:e.room,callback:function(t){e.room=t},expression:"room"}}),a("el-button",{attrs:{disabled:e.isBtnDisabled,loading:e.btnLoading,type:"success"},on:{click:function(t){return e.changeState(3)}}},[e._v(" 创建 ")])],1)],1):3===e.state?a("div",[a("h1",{},[e._v("正在等待玩家加入"+e._s(e.room)),a("span",{attrs:{id:"left_time"}},[e._v(e._s(e.leftTime))])]),a("span",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{id:"waiting_circle"}}),a("span",{attrs:{id:"players_num"}},[e._v(e._s(e.playerNum)+"/2")])]):4===e.state?a("div",[a("h1",[e._v("加入房间")]),a("el-row",{attrs:{align:"center",type:"flex"}},[a("el-input",{staticClass:"input",attrs:{maxlength:"20",type:"text"},model:{value:e.room,callback:function(t){e.room=t},expression:"room"}}),a("el-button",{attrs:{disabled:e.isBtnDisabled,loading:e.btnLoading,type:"success"},on:{click:function(t){return e.changeState(5)}}},[e._v(" 加入 ")])],1)],1):5===e.state?a("div",[a("h1",[e._v("游戏准备中...")]),a("div",{attrs:{id:"connecting_circle_container"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{id:"connecting_circle"}})])]):e._e()]):e._e()},P=[],T={data(){return{state:1,room:"",leftTime:120,playerNum:1,loading:!1,btnLoading:!1}},methods:{changeState(e){2===e||4===e?this.state=e:3===e?(this.btnLoading=!0,this.$axios.get(this.$store.state.backURL+"/game/"+this.$parent.gameUrl+"/create_room?room="+this.room).then((e=>{if(200===e.data.code){this.$message({type:"success",message:"房间创建成功了！"});let e=setInterval((()=>{this.leftTime>0&&(this.leftTime--,0===this.leftTime&&clearInterval(e))}),1e3);this.state=3,this.btnLoading=!1,this.loading=!0,this.$parent.waitPlayer()}else 420===e.data.code&&(this.$message.error(e.data.msg),this.btnLoading=!1)}))):5===e?(this.btnLoading=!0,this.$parent.enterRoom()):this.$message.error("错误的参数。")},startGame(){this.state=5,this.loading=!0,this.$parent.gaming()},enterDuoRoom(){this.$axios.get(this.$store.state.backURL+"/game/"+this.$parent.gameUrl+"/enter_room?room="+this.room).then((e=>{200===e.data.code?(this.$message({type:"success",message:"加入房间成功！开始游戏。"}),this.startGame(),this.$parent.gameData.opponent=e.data.opponent):(this.$message.error(e.data.msg),this.btnLoading=!1)}))},waitDuoPlayer(){this.$axios.get(this.$store.state.backURL+"/game/"+this.$parent.gameUrl+"/wait_player").then((e=>{200===e.data.code?(this.loading=!1,this.playerNum=2,this.$message({type:"success",message:"人数够了，开始游戏。"}),this.startGame()):421===e.data.code?(this.$message.error("等待玩家超时。"),this.state=1):320===e.data.code||this.$message.error(e.data.msg)}))}},computed:{isBtnDisabled(){return""===this.room||null==this.room}}},R=T,M=(0,l.Z)(R,L,P,!1,null,"4321516b",null),I=M.exports,N={components:{PregameComponent:I},data(){return{gameUrl:"odd_even",wsObj:null,state:0,usedChips:[],unusedChips:[],gameData:{round:0,roleFlag:-1,chip:0,usedChip:0,opponent:"",oddOrEven:0,deltaChip:0,gameOver:!1,prevOpponentUsedChip:0,prevUsed:0}}},methods:{arrayElemIdx(e,t){for(let a=0;a<e.length;a++)if(e[a]===t)return a;return-1},useOneChip(e){if(this.gameData.usedChip<this.gameData.chip){this.gameData.usedChip++;let t=this.arrayElemIdx(this.unusedChips,e);this.unusedChips.splice(t,1);for(let e=0;e<this.usedChips.length;e++)if(-1===this.arrayElemIdx(this.usedChips,e))return void this.usedChips.push(e);this.usedChips.push(this.usedChips.length)}},resetOneChip(e){if(this.unusedChip<this.gameData.chip){this.gameData.usedChip--;let t=this.arrayElemIdx(this.usedChips,e);this.usedChips.splice(t,1);for(let e=0;e<this.unusedChips.length;e++)if(-1===this.arrayElemIdx(this.unusedChips,e))return void this.unusedChips.push(e);this.unusedChips.push(this.unusedChips.length)}},waitPlayer(){this.$refs.pregame.waitDuoPlayer()},enterRoom(){this.$refs.pregame.enterDuoRoom()},createWebSocket(){let e="ws://"+this.$store.state.backURL.split("http://")[1]+"/game/"+this.gameUrl+"/gaming?login-token="+localStorage.token;try{this.wsObj=new WebSocket(e),this.initWSEventHandle()}catch(t){this.$message.error("连接失败，刷新试试。")}},initWSEventHandle(){this.wsObj.onopen=e=>{this.$message({type:"success",message:"服务器连接成功"})},this.wsObj.onmessage=e=>{-1===this.gameData.roleFlag&&(this.$refs.pregame.state=-1);let t=JSON.parse(e.data);switch(t.opt){case 1:this.gameData.deltaChip=t.data.chip-this.gameData.chip,this.gameData.chip=t.data.chip,this.gameData.prevUsed=this.gameData.usedChip,this.gameData.usedChip=0,this.gameData.roleFlag=t.data.roleFlag,this.gameData.gameOver=t.data.gameOver,this.gameData.prevOpponentUsedChip=t.data.prevOpponentUsedChip,2===this.state?this.state=3:0===this.state&&this.nextRound();break;case 2:this.$message.info("对手已经离开了。"),this.wsObj.close(),this.gameData.gameOver||(Object.assign(this.$data,this.$options.data()),Object.assign(this.$refs.pregame.$data,this.$refs.pregame.$options.data()));break;case 3:this.gameData.opponent=t.data.opponent;break}},this.wsObj.onclose=e=>{this.$message({type:"info",message:"已与服务器断开连接。"})}},sendData(){this.state=2,1===this.gameData.roleFlag?this.wsObj.send(JSON.stringify({usedChip:this.gameData.usedChip,oddOrEven:this.gameData.oddOrEven})):this.wsObj.send(this.gameData.usedChip)},gaming(){this.createWebSocket()},changeOddOrEven(){this.gameData.oddOrEven=0===this.gameData.oddOrEven?1:0},nextRound(){this.gameData.round++,this.state=this.gameData.gameOver?4:1,this.usedChips=[],this.unusedChips=[];for(let e=0;e<this.unusedChip;e++)setTimeout((()=>{this.unusedChips.push(e)}),100*e);this.gameData.gameOver&&this.$message.info("游戏结束，即将与服务器断开连接。")},getOpponentGuess(){return this.gameData.deltaChip>0&&this.gameData.usedChip%2===0?"单":"双"}},computed:{unusedChip(){return this.gameData.chip-this.gameData.usedChip},oddOrEvenStr(){return 0===this.gameData.oddOrEven?"双":"单"},isBtnDisabled(){return 1===this.gameData.roleFlag&&0===this.gameData.usedChip},oddEvenStyle(){return this.gameData.roleFlag>-1?"display: flex; justify-content: center":"display: flex; align-items: center; justify-content: center"}},beforeCreate(){this.$store.state.currentGameTitle="猜单双"},beforeDestroy(){null!=this.wsObj&&this.wsObj.close(),3===this.$refs.pregame.state&&this.$axios.get(this.$store.state.backURL+"/game/"+this.gameUrl+"/stop_waiting").then((e=>{200===e.data.code&&this.$message.info("房间已关闭。")}))}},B=N,Z=(0,l.Z)(B,F,U,!1,null,"6e623f5d",null),H=Z.exports,A=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"phone_not_allowed"},[a("div",{attrs:{id:"phone_not_allowed_content"}},[a("h1",{attrs:{id:"notice"}},[e._v(e._s(this.$route.params.errorMsg))]),a("span",{attrs:{id:"comment1"}},[e._v("wjn真帅")])])])},G=[],K={mounted(){null!=this.$route.params.errorMsg&&""!==this.$route.params.errorMsg||this.$router.replace("/home")}},z=K,V=(0,l.Z)(z,A,G,!1,null,null,null),J=V.exports,q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"chat_room"}},[e._m(0),a("div",{attrs:{id:"record_container"}},[a("div",{staticStyle:{display:"inline-block",width:"60%"},attrs:{id:"record_area"}},e._l(e.records,(function(t,s){return a("div",{key:s,staticStyle:{"margin-bottom":"10px"}},[a("span",{staticStyle:{color:"deepskyblue","margin-right":"20px"}},[e._v(e._s(t.username))]),a("span",{staticStyle:{color:"gray"}},[e._v(e._s(t.createTime))]),a("br"),a("span",{staticStyle:{width:"100%","font-size":"20px","word-wrap":"break-word","word-break":"break-all"},domProps:{innerHTML:e._s(t.content)}})])})),0),a("div",{attrs:{id:"users_container"}},[a("h3",[e._v("在线用户列表")]),a("div",{staticStyle:{overflow:"auto"}},e._l(e.onlineUsers,(function(t,s){return a("p",{key:s},[e._v(e._s(t))])})),0)])]),a("div",{attrs:{id:"send_container"}},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.toSend,expression:"toSend"}],attrs:{id:"input_area",disabled:e.inputDisabled,placeholder:e.inputPlaceholder,maxlength:"500"},domProps:{value:e.toSend},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:e.keyCtrlEnter.apply(null,arguments):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.keyEnter.apply(null,arguments)}],input:function(t){t.target.composing||(e.toSend=t.target.value)}}}),a("el-button",{style:e.btnStyle,attrs:{id:"btn_send",disabled:e.isBtnDisabled,type:"success"},on:{click:e.send}},[e._v("发送消息 ")])],1)])},X=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"reminder_container"}},[a("p",[e._v("聊天室只会展示近3天的记录（除非你不退出）")])])}],Y={name:"ChatRoomView",data(){return{wsObj:null,toSend:"",records:[],isAltEnter:!1,onlineUsers:[],inputPlaceholder:"请输入内容（enter发送，ctrl+enter换行）",inputDisabled:!1}},methods:{createWebSocket(){let e="ws://"+this.$store.state.backURL.split("http://")[1]+"/game/chat_room/chatting?login-token="+localStorage.token;try{this.wsObj=new WebSocket(e),this.initWSEventHandle()}catch(t){this.$message.error("连接失败，刷新试试。")}},initWSEventHandle(){this.wsObj.onopen=e=>{console.log(e),this.$message({type:"success",message:"与聊天室成功连接。"})},this.wsObj.onmessage=e=>{let t=JSON.parse(e.data);switch(t.opt){case 1:for(let e in t.onlineUsers)this.onlineUsers=t.onlineUsers;break;case 2:t.message.content=t.message.content.replace(/\n/g,"<br/>"),this.records.push(t.message),setTimeout((()=>{this.scrollToBottom()}),1)}},this.wsObj.onclose=e=>{this.$message.info("已与聊天室断开连接。"),this.inputDisabled=!0,this.inputPlaceholder="离线状态，请刷新。",this.onlineUsers=[]}},send(){this.wsObj.send(this.toSend),this.toSend="",this.$("#input_area").focus()},scrollToBottom(){let e=document.getElementById("record_area");e.scrollTop=e.scrollHeight+1e3},keyCtrlEnter(e){let t=this.$("#input_area")[0],a=t.selectionStart;t.value=t.value.substr(0,a)+content+t.value.substr(a)},keyEnter(e){e.preventDefault(),this.isBtnDisabled||this.send()}},computed:{btnStyle(){return this.isBtnDisabled?"cursor: not-allowed":"cursor: pointer"},isBtnDisabled(){return""===this.toSend||null==this.toSend}},beforeCreate(){this.$store.state.currentGameTitle="聊天室"},mounted(){this.$axios.get(this.$store.state.backURL+"/chat_room/get_history").then((e=>{if(200===e.data.code){let t=e.data.historyRecords;for(let e=0;e<t.length;e++)t[e].content=t[e].content.replace(/\n/g,"<br/>");this.records=t,setTimeout((()=>{this.scrollToBottom()}),1)}else this.$message.error("获取历史聊天记录失败，刷新试试。")})),this.createWebSocket()},beforeDestroy(){null!=this.wsObj&&this.wsObj.close()}},Q=Y,ee=(0,l.Z)(Q,q,X,!1,null,"d4c6f3aa",null),te=ee.exports,ae=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"gobang"},[a("PregameComponent",{ref:"pregame"}),e.gameData.roleFlag>-1?a("div",{attrs:{id:"game_body"}},[a("div",{staticClass:"content_center"},[a("h1",[e._v("对手："),a("span",{staticStyle:{color:"#409EFF"}},[e._v(e._s(e.gameData.opponent))]),a("span",{staticStyle:{"margin-left":"30px"}},[e._v("我方："),0===e.gameData.roleFlag?a("span",{staticStyle:{"border-radius":"10px",padding:"5px"}},[e._v("黑")]):a("span",{staticStyle:{color:"white","-webkit-text-stroke":"1px black","border-radius":"10px",padding:"5px"}},[e._v("白")])])])]),a("canvas",{attrs:{id:"board"}}),a("div",{staticClass:"content_center",staticStyle:{overflow:"hidden"}},[a("transition",{attrs:{"enter-active-class":"animate__animated animate__backInRight","leave-active-class":"animate__animated animate__backOutLeft"}},[1===e.noticeState?a("h1",{key:"1",staticStyle:{color:"#67C23A"}},[e._v(" 轮到我方落子。 ")]):e._e(),2===e.noticeState?a("h1",{key:"2"},[e._v(" 等待对方落子... ")]):a("h1",{key:"3"},[e._v("游戏结束。"),e.gameData.winner!==e.gameData.roleFlag?a("span",{staticStyle:{color:"#F56C6C"}},[e._v("你输了。")]):a("span",{staticStyle:{color:"#67C23A"}},[e._v("你赢了。")])])])],1)]):e._e()],1)},se=[],ie={components:{PregameComponent:I},data(){return{gameUrl:"gobang",ctx:null,cellWidth:40,r:10,wsObj:null,uploading:!1,gameData:{opponent:"",gomoku:null,roleFlag:-1,turn:-1,winner:-1}}},methods:{drawBoard(){let e=this.$("#board")[0];this.ctx=e.getContext("2d"),e.width=e.height=16*this.cellWidth,this.ctx.strokeStyle="#000000";for(let t=0;t<15;t++)this.ctx.beginPath(),this.ctx.moveTo((t+1)*this.cellWidth,this.cellWidth),this.ctx.lineTo((t+1)*this.cellWidth,15*this.cellWidth),this.ctx.stroke();for(let t=0;t<15;t++)this.ctx.beginPath(),this.ctx.moveTo(this.cellWidth,(t+1)*this.cellWidth),this.ctx.lineTo(15*this.cellWidth,(t+1)*this.cellWidth),this.ctx.stroke()},handleClick(e){if(console.log(this.gameData.winner),-1!==this.gameData.winner)return void this.$message.warning("游戏已经结束了。");if(this.uploading)return void this.$message.warning("落子已提交，等待服务器响应。");if(this.gameData.roleFlag!==this.gameData.turn)return void this.$message.warning("对手的回合，请等待对手下棋。");let t=e.offsetX-this.cellWidth,a=e.offsetY-this.cellWidth,s=this.close(t,0,14),i=this.close(a,0,14),r=[],n=Math.abs(t-s[0]*this.cellWidth)<Math.abs(t-s[1]*this.cellWidth)?Math.abs(t-s[0]*this.cellWidth)<this.r?s[0]*this.cellWidth:void 0:Math.abs(t-s[1]*this.cellWidth)<this.r?s[1]*this.cellWidth:void 0,o=Math.abs(a-i[0]*this.cellWidth)<Math.abs(a-i[1]*this.cellWidth)?Math.abs(a-i[0]*this.cellWidth)<this.r?i[0]*this.cellWidth:void 0:Math.abs(a-i[1]*this.cellWidth)<this.r?i[1]*this.cellWidth:void 0;void 0!==n&&void 0!==o&&(r=[n,o]),0!==r.length&&this.setNode(r)},close(e,t,a){e=e<0?0:e,e=e>14*this.cellWidth?14*this.cellWidth:e;let s=a-t;if(1===s)return[t,a];if(e<(t+Math.ceil(s/2))*this.cellWidth){let a=t,i=t+Math.ceil(s/2);return this.close(e,a,i)}{let i=t+Math.ceil(s/2),r=a;return this.close(e,i,r)}},setNode(e){void 0===this.gameData.gomoku[e[0]/this.cellWidth][e[1]/this.cellWidth]&&this.gameData.roleFlag===this.gameData.turn&&this.wsObj.send(e[0]/this.cellWidth+","+e[1]/this.cellWidth)},enterRoom(){this.$refs.pregame.enterDuoRoom()},waitPlayer(){this.$refs.pregame.waitDuoPlayer()},createWebSocket(){let e="ws://"+this.$store.state.backURL.split("http://")[1]+"/game/"+this.gameUrl+"/gaming?login-token="+localStorage.token;try{this.wsObj=new WebSocket(e),this.initWSEventHandle()}catch(t){this.$message.error("连接失败，刷新试试。")}},initWSEventHandle(){this.wsObj.onopen=e=>{this.$message({type:"success",message:"服务器连接成功"})},this.wsObj.onmessage=e=>{-1===this.gameData.roleFlag&&(this.$refs.pregame.state=-1);let t=JSON.parse(e.data);switch(t.opt){case 1:this.uploading=!1;let e=t.data.newPiece,a=[parseInt(e.split(",")[0])*this.cellWidth,parseInt(e.split(",")[1])*this.cellWidth];this.gameData.roleFlag=t.data.roleFlag,0===this.gameData.turn?(this.ctx.fillStyle="black",this.ctx.beginPath(),this.ctx.arc(a[0]+this.cellWidth,a[1]+this.cellWidth,this.r,0,2*Math.PI),this.ctx.stroke(),this.ctx.fill(),this.gameData.gomoku[a[0]/this.cellWidth][a[1]/this.cellWidth]=this.roleFlag,this.roleFlag=1):(this.ctx.fillStyle="white",this.ctx.beginPath(),this.ctx.arc(a[0]+this.cellWidth,a[1]+this.cellWidth,this.r,0,2*Math.PI),this.ctx.stroke(),this.ctx.fill(),this.gameData.gomoku[a[0]/this.cellWidth][a[1]/this.cellWidth]=this.roleFlag,this.roleFlag=0),this.gameData.turn=t.data.turn,-1!==t.data.winner&&(this.gameData.winner=t.data.winner,this.$message.info("游戏结束，即将与服务器断开连接。"));break;case 2:this.$message.info("对手已经离开了。"),this.wsObj.close(),-1===this.gameData.winner&&(Object.assign(this.$data,this.$options.data()),Object.assign(this.$refs.pregame.$data,this.$refs.pregame.$options.data()));break;case 3:this.gameData.opponent=t.opponent,this.gameData.roleFlag=t.data.roleFlag,this.gameData.turn=t.data.turn,setTimeout((()=>{this.drawBoard();let e=this.$("#board")[0];e.addEventListener("click",this.handleClick),this.gameData.gomoku=new Array(15);for(let t=0;t<this.gameData.gomoku.length;t++)this.gameData.gomoku[t]=new Array(15)}),1);break}},this.wsObj.onclose=e=>{this.$message({type:"info",message:"已与服务器断开连接。"})}},gaming(){this.createWebSocket()}},computed:{noticeState(){return-1!==this.gameData.winner?3:this.gameData.turn!==this.gameData.roleFlag?2:1}},beforeCreate(){this.$store.state.currentGameTitle="五子棋"},beforeDestroy(){null!=this.wsObj&&this.wsObj.close(),3===this.$refs.pregame.state&&this.$axios.get(this.$store.state.backURL+"/game/"+this.gameUrl+"/stop_waiting").then((e=>{200===e.data.code&&this.$message.info("房间已关闭。")}))}},re=ie,ne=(0,l.Z)(re,ae,se,!1,null,"8c91914e",null),oe=ne.exports;s["default"].use(d.Z);const le=[{path:"/",redirect:"/home"},{path:"/home",name:"home",component:f,meta:{notNeedLogin:!0}},{path:"/login",name:"login",component:D,meta:{notNeedLogin:!0}},{path:"/game",name:"game",component:j,children:[{path:"odd_even",name:"odd_even",component:H},{path:"gobang",name:"gobang",component:oe},{path:"chat_room",name:"chat_room",component:te}]},{path:"/error",name:"error",component:J,meta:{notNeedLogin:!0}}],he=new d.Z({mode:"hash",base:"",routes:le});he.beforeEach((function(e,t,a){e.meta.notNeedLogin||localStorage.getItem("token")?a():a({name:"login",params:{notice:!0}})}));var ce=he,de=a(4665);s["default"].use(de.ZP);var me=new de.ZP.Store({state:{currentGameTitle:"",backURL:"http://81.70.199.187:1023",serverErrMsg:"服务器有点问题，稍后再试试。"},getters:{},mutations:{},actions:{},modules:{}}),ge=a(6166),pe=a.n(ge),ue=a(4549),ve=a.n(ue),fe=a(4029),_e=a.n(fe),be=a(12);s["default"].use(ve()),pe().defaults.withCredentials=!0,s["default"].prototype.$axios=pe(),s["default"].prototype.$=_e(),s["default"].config.productionTip=!1,s["default"].use(be.Z),new s["default"]({router:ce,store:me,render:e=>e(c)}).$mount("#app")}},t={};function a(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={exports:{}};return e[s].call(r.exports,r,r.exports,a),r.exports}a.m=e,function(){a.amdO={}}(),function(){var e=[];a.O=function(t,s,i,r){if(!s){var n=1/0;for(c=0;c<e.length;c++){s=e[c][0],i=e[c][1],r=e[c][2];for(var o=!0,l=0;l<s.length;l++)(!1&r||n>=r)&&Object.keys(a.O).every((function(e){return a.O[e](s[l])}))?s.splice(l--,1):(o=!1,r<n&&(n=r));if(o){e.splice(c--,1);var h=i();void 0!==h&&(t=h)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[s,i,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var i,r,n=s[0],o=s[1],l=s[2],h=0;if(n.some((function(t){return 0!==e[t]}))){for(i in o)a.o(o,i)&&(a.m[i]=o[i]);if(l)var c=l(a)}for(t&&t(s);h<n.length;h++)r=n[h],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(c)},s=self["webpackChunkmy_games_frontend"]=self["webpackChunkmy_games_frontend"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[998],(function(){return a(3955)}));s=a.O(s)})();
//# sourceMappingURL=app.1671ae73.js.map